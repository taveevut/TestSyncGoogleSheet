<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ú‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, .95);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, .1);
      overflow: hidden
    }

    .header {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
      padding: 30px;
      text-align: center
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, .3)
    }

    .header p {
      font-size: 1.2em;
      opacity: .9
    }

    .main-content {
      padding: 30px
    }

    .controls {
      display: flex;
      gap: 15px;
      margin-bottom: 30px;
      flex-wrap: wrap;
      align-items: center
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all .3s ease;
      text-transform: uppercase;
      letter-spacing: 1px
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
      box-shadow: 0 4px 15px rgba(102, 126, 234, .4)
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, .6)
    }

    .btn-success {
      background: linear-gradient(135deg, #56ab2f, #a8e6cf);
      color: #fff;
      box-shadow: 0 4px 15px rgba(86, 171, 47, .4)
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(86, 171, 47, .6)
    }

    .btn-danger {
      background: linear-gradient(135deg, #ff416c, #ff4b2b);
      color: #fff;
      box-shadow: 0 4px 15px rgba(255, 65, 108, .4)
    }

    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 65, 108, .6)
    }

    .btn-warning {
      background: linear-gradient(135deg, #f7971e, #ffd200);
      color: #fff;
      box-shadow: 0 4px 15px rgba(247, 151, 30, .4)
    }

    .btn-warning:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(247, 151, 30, .6)
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, .7);
      backdrop-filter: blur(5px)
    }

    .modal-content {
      background: #fff;
      margin: 5% auto;
      padding: 30px;
      border-radius: 20px;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, .3);
      animation: modalFadeIn .3s ease
    }

    @keyframes modalFadeIn {
      from {
        opacity: 0;
        transform: translateY(-50px)
      }

      to {
        opacity: 1;
        transform: translateY(0)
      }
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      transition: color .3s ease
    }

    .close:hover {
      color: #ff416c
    }

    .form-group {
      margin-bottom: 20px
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      transition: all .3s ease
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      border-color: #667eea;
      outline: none;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, .1)
    }

    .table-container {
      background: #fff;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, .1)
    }

    .table {
      width: 100%;
      border-collapse: collapse
    }

    .table th {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
      padding: 15px;
      text-align: left;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px
    }

    .table td {
      padding: 15px;
      border-bottom: 1px solid #e0e0e0;
      transition: background-color .3s ease
    }

    .table tbody tr:hover {
      background: #f8f9ff
    }

    .table tbody tr:nth-child(even) {
      background: #fafafa
    }

    .action-buttons {
      display: flex;
      gap: 8px
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 14px;
      border-radius: 6px
    }

    .image-preview {
      max-width: 100px;
      max-height: 100px;
      border-radius: 8px;
      cursor: pointer;
      transition: transform .3s ease
    }

    .image-preview:hover {
      transform: scale(1.1)
    }

    .search-box {
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      width: 300px;
      transition: all .3s ease
    }

    .search-box:focus {
      border-color: #667eea;
      outline: none;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, .1)
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px
    }

    .stat-card {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(102, 126, 234, .3)
    }

    .stat-number {
      font-size: 2.5em;
      font-weight: bold;
      margin-bottom: 5px
    }

    .stat-label {
      font-size: 1em;
      opacity: .9
    }

    .google-sheets-info {
      background: linear-gradient(135deg, #4285f4, #34a853);
      color: #fff;
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 30px;
      text-align: center
    }

    .severity-high {
      color: #ff416c;
      font-weight: bold
    }

    .severity-medium {
      color: #f7971e;
      font-weight: bold
    }

    .severity-low {
      color: #56ab2f;
      font-weight: bold
    }

    .image-upload-area {
      border: 2px dashed #667eea;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all .3s ease
    }

    .image-upload-area:hover {
      background: #f8f9ff;
      border-color: #764ba2
    }

    .uploaded-images {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px
    }

    .image-item {
      position: relative;
      display: inline-block
    }

    .remove-image {
      position: absolute;
      top: -8px;
      right: -8px;
      background: #ff416c;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      font-size: 12px
    }

    @media print {
      body * {
        visibility: hidden
      }

      .table-container,
      .table-container * {
        visibility: visible
      }

      .table-container {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%
      }

      .btn,
      .controls,
      .modal {
        display: none !important
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>üìö ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ú‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
      <p>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
    </div>

    <div class="main-content">
      <div class="google-sheets-info">
        <h3>üîó ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets</h3>
        <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÉ‡∏ô Google Sheets ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
        <button class="btn btn-primary"
                onclick="connectGoogleSheets()">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets</button>
      </div>

      <div class="stats">
        <div class="stat-card">
          <div class="stat-number"
               id="totalIncidents">0</div>
          <div class="stat-label">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
        </div>
        <div class="stat-card">
          <div class="stat-number"
               id="highSeverityCount">0</div>
          <div class="stat-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏™‡∏π‡∏á</div>
        </div>
        <div class="stat-card">
          <div class="stat-number"
               id="mediumSeverityCount">0</div>
          <div class="stat-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á</div>
        </div>
        <div class="stat-card">
          <div class="stat-number"
               id="lowSeverityCount">0</div>
          <div class="stat-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏ï‡πà‡∏≥</div>
        </div>
      </div>

      <div class="controls">
        <button class="btn btn-success"
                onclick="openModal()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</button>
        <button class="btn btn-primary"
                onclick="exportToExcel()">üìä ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô Excel</button>
        <button class="btn btn-warning"
                onclick="importFromExcel()">üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏≤‡∏Å Excel</button>
        <input type="text"
               class="search-box"
               id="searchInput"
               placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..."
               onkeyup="searchRecords()">
        <input type="file"
               id="excelImport"
               accept=".xlsx,.xls"
               style="display:none"
               onchange="handleExcelImport(event)">
      </div>

      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
              <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
              <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
              <th>‡∏ä‡∏±‡πâ‡∏ô</th>
              <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ú‡∏¥‡∏î</th>
              <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
              <th>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á</th>
              <th>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
              <th>‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</th>
              <th>‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
            </tr>
          </thead>
          <tbody id="recordsTable"></tbody>
        </table>
      </div>
    </div>
  </div>

  <div id="recordModal"
       class="modal">
    <div class="modal-content">
      <span class="close"
            onclick="closeModal()">&times;</span>
      <h2 id="modalTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</h2>
      <form id="recordForm">
        <div class="form-group"><label for="studentId">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</label><input type="text"
                 id="studentId"
                 required></div>
        <div class="form-group"><label for="studentName">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</label><input type="text"
                 id="studentName"
                 required></div>
        <div class="form-group"><label for="className">‡∏ä‡∏±‡πâ‡∏ô:</label><input type="text"
                 id="className"
                 required></div>
        <div class="form-group">
          <label for="incidentType">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ú‡∏¥‡∏î:</label>
          <select id="incidentType"
                  required>
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
            <option value="‡∏°‡∏≤‡∏™‡∏≤‡∏¢">‡∏°‡∏≤‡∏™‡∏≤‡∏¢</option>
            <option value="‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô">‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô</option>
            <option value="‡πÑ‡∏°‡πà‡∏™‡∏ß‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏ö‡∏ö">‡πÑ‡∏°‡πà‡∏™‡∏ß‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏ö‡∏ö</option>
            <option value="‡∏ó‡∏∞‡πÄ‡∏•‡∏≤‡∏∞‡∏ß‡∏¥‡∏ß‡∏≤‡∏ó">‡∏ó‡∏∞‡πÄ‡∏•‡∏≤‡∏∞‡∏ß‡∏¥‡∏ß‡∏≤‡∏ó</option>
            <option value="‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà">‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà</option>
            <option value="‡∏û‡∏Å‡∏≠‡∏≤‡∏ß‡∏∏‡∏ò">‡∏û‡∏Å‡∏≠‡∏≤‡∏ß‡∏∏‡∏ò</option>
            <option value="‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô">‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</option>
            <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
          </select>
        </div>
        <div class="form-group"><label for="description">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</label><textarea id="description"
                    rows="3"
                    required></textarea></div>
        <div class="form-group">
          <label for="severity">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á:</label>
          <select id="severity"
                  required>
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á</option>
            <option value="‡∏ï‡πà‡∏≥">‡∏ï‡πà‡∏≥</option>
            <option value="‡∏Å‡∏•‡∏≤‡∏á">‡∏Å‡∏•‡∏≤‡∏á</option>
            <option value="‡∏™‡∏π‡∏á">‡∏™‡∏π‡∏á</option>
          </select>
        </div>
        <div class="form-group"><label for="recorder">‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:</label><input type="text"
                 id="recorder"
                 required></div>
        <div class="form-group">
          <label>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö:</label>
          <div class="image-upload-area"
               onclick="document.getElementById('imageInput').click()">
            <p>üì∑ ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5 ‡∏£‡∏π‡∏õ)</p>
            <input type="file"
                   id="imageInput"
                   multiple
                   accept="image/*"
                   style="display:none"
                   onchange="handleImageUpload(event)">
          </div>
          <div class="uploaded-images"
               id="uploadedImages"></div>
        </div>
        <div class="controls">
          <button type="submit"
                  class="btn btn-success">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          <button type="button"
                  class="btn btn-danger"
                  onclick="closeModal()">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    /** ========= CONFIG ========= */
    const SPREADSHEET_ID = '1Lc5F9JDq8X_ZxJxcd2D_eY_v25vtVdLVxS0pOKvC6nU'; // ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏î‡∏¥‡∏°
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyaRR3dN_obgdXFG2so-aqH1ki2wnefXoxVDqXqnYDWBwnigVkZAEaLCd5a8kJCmisBXA/exec';
    /** ========================= */

    let records = [];
    let currentEditIndex = -1;
    let uploadedImages = [];
    let isGoogleSheetsConnected = false;

    // Init
    document.addEventListener('DOMContentLoaded', () => {
      loadSampleData();
      updateStatistics();
      displayRecords();
      addTooltips();
      addAdditionalControls();
    });

    function loadSampleData() {
      records = [
        {date: '2025-01-15', studentId: 'ST001', studentName: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ', className: '‡∏°.4/1', incidentType: '‡∏°‡∏≤‡∏™‡∏≤‡∏¢', description: '‡∏°‡∏≤‡∏™‡∏≤‡∏¢ 15 ‡∏ô‡∏≤‡∏ó‡∏µ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ö‡∏•‡∏≤', severity: '‡∏ï‡πà‡∏≥', images: [], recorder: '‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á'},
        {date: '2025-01-14', studentId: 'ST002', studentName: '‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', className: '‡∏°.5/2', incidentType: '‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô', description: '‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô', severity: '‡∏Å‡∏•‡∏≤‡∏á', images: [], recorder: '‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ß‡∏¥‡∏ä‡∏±‡∏¢'}
      ];
    }

    // ===== Modal =====
    function openModal(index = -1) {
      currentEditIndex = index;
      const modal = document.getElementById('recordModal');
      const modalTitle = document.getElementById('modalTitle');
      if (index >= 0) {
        modalTitle.textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';
        fillFormData(records[index]);
      } else {
        modalTitle.textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà';
        document.getElementById('recordForm').reset();
        uploadedImages = [];
        displayUploadedImages();
      }
      modal.style.display = 'block';
    }
    function closeModal() {
      document.getElementById('recordModal').style.display = 'none';
      uploadedImages = [];
      displayUploadedImages();
    }
    function fillFormData(record) {
      document.getElementById('studentId').value = record.studentId;
      document.getElementById('studentName').value = record.studentName;
      document.getElementById('className').value = record.className;
      document.getElementById('incidentType').value = record.incidentType;
      document.getElementById('description').value = record.description;
      document.getElementById('severity').value = record.severity;
      document.getElementById('recorder').value = record.recorder;
      uploadedImages = [...record.images];
      displayUploadedImages();
    }

    // ===== Form submit =====
    document.getElementById('recordForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = {
        date: new Date().toISOString().split('T')[0],
        studentId: document.getElementById('studentId').value,
        studentName: document.getElementById('studentName').value,
        className: document.getElementById('className').value,
        incidentType: document.getElementById('incidentType').value,
        description: document.getElementById('description').value,
        severity: document.getElementById('severity').value,
        images: [...uploadedImages],
        recorder: document.getElementById('recorder').value
      };

      if (currentEditIndex >= 0) {
        records[currentEditIndex] = formData;
        alert('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
      } else {
        records.push(formData);
        alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
      }

      if (isGoogleSheetsConnected) {
        await syncToGoogleSheets(formData);
      }

      updateStatistics();
      displayRecords();
      closeModal();
    });

    // ===== Image upload =====
    function handleImageUpload(event) {
      const files = Array.from(event.target.files);
      if (uploadedImages.length + files.length > 5) {
        alert('‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5 ‡∏£‡∏π‡∏õ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
        return;
      }
      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = (e) => {
          uploadedImages.push({name: file.name, data: e.target.result});
          displayUploadedImages();
        };
        reader.readAsDataURL(file);
      });
    }
    function displayUploadedImages() {
      const container = document.getElementById('uploadedImages');
      container.innerHTML = '';
      uploadedImages.forEach((image, index) => {
        const div = document.createElement('div');
        div.className = 'image-item';
        div.innerHTML = `
      <img src="${image.data}" alt="${image.name}" class="image-preview" style="width:60px;height:60px;object-fit:cover;">
      <button type="button" class="remove-image" onclick="removeImage(${index})">√ó</button>
    `;
        container.appendChild(div);
      });
    }
    function removeImage(index) {
      uploadedImages.splice(index, 1);
      displayUploadedImages();
    }

    // ===== Table & actions =====
    function displayRecords() {
      const tbody = document.getElementById('recordsTable');
      tbody.innerHTML = '';
      records.forEach((record, index) => {
        const row = document.createElement('tr');
        const sevClass = record.severity === '‡∏™‡∏π‡∏á' ? 'high' : (record.severity === '‡∏Å‡∏•‡∏≤‡∏á' ? 'medium' : 'low');
        row.innerHTML = `
      <td>${record.date}</td>
      <td>${record.studentId}</td>
      <td>${record.studentName}</td>
      <td>${record.className}</td>
      <td>${record.incidentType}</td>
      <td>${record.description}</td>
      <td><span class="severity-${sevClass}">${record.severity}</span></td>
      <td>${record.images.length > 0 ? `<img src="${record.images[0].data}" alt="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û" class="image-preview" onclick="showImageModal('${record.images[0].data}')">${record.images.length > 1 ? ` (+${record.images.length - 1})` : ''}` : '‡πÑ‡∏°‡πà‡∏°‡∏µ'}</td>
      <td>${record.recorder}</td>
      <td>
        <div class="action-buttons">
          <button class="btn btn-warning btn-sm" onclick="openModal(${index})">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
          <button class="btn btn-danger btn-sm" onclick="deleteRecord(${index})">üóëÔ∏è ‡∏•‡∏ö</button>
        </div>
      </td>
    `;
        tbody.appendChild(row);
      });
    }
    function deleteRecord(index) {
      if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
        records.splice(index, 1);
        updateStatistics();
        displayRecords();
        alert('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
      }
    }
    function searchRecords() {
      const q = document.getElementById('searchInput').value.toLowerCase();
      const rows = document.getElementById('recordsTable').getElementsByTagName('tr');
      Array.from(rows).forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(q) ? '' : 'none';
      });
    }
    function updateStatistics() {
      document.getElementById('totalIncidents').textContent = records.length;
      document.getElementById('highSeverityCount').textContent = records.filter(r => r.severity === '‡∏™‡∏π‡∏á').length;
      document.getElementById('mediumSeverityCount').textContent = records.filter(r => r.severity === '‡∏Å‡∏•‡∏≤‡∏á').length;
      document.getElementById('lowSeverityCount').textContent = records.filter(r => r.severity === '‡∏ï‡πà‡∏≥').length;
    }

    // ===== Excel =====
    function exportToExcel() {
      const ws = XLSX.utils.json_to_sheet(records.map(r => ({
        '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà': r.date, '‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô': r.studentId, '‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•': r.studentName, '‡∏ä‡∏±‡πâ‡∏ô': r.className,
        '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ú‡∏¥‡∏î': r.incidentType, '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î': r.description, '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á': r.severity,
        '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û': r.images.length, '‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å': r.recorder
      })));
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ú‡∏¥‡∏î');
      XLSX.writeFile(wb, `‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ú‡∏¥‡∏î‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô_${new Date().toISOString().split('T')[0]}.xlsx`);
    }
    function importFromExcel() {document.getElementById('excelImport').click();}
    function handleExcelImport(event) {
      const file = event.target.files[0]; if (!file) return;
      const reader = new FileReader();
      reader.onload = (e) => {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, {type: 'array'});
        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
        const jsonData = XLSX.utils.sheet_to_json(worksheet);
        jsonData.forEach(row => {
          records.push({
            date: row['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà'] || new Date().toISOString().split('T')[0],
            studentId: row['‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'] || '',
            studentName: row['‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•'] || '',
            className: row['‡∏ä‡∏±‡πâ‡∏ô'] || '',
            incidentType: row['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ú‡∏¥‡∏î'] || '',
            description: row['‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'] || '',
            severity: row['‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á'] || '‡∏ï‡πà‡∏≥',
            images: [],
            recorder: row['‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å'] || ''
          });
        });
        updateStatistics();
        displayRecords();
        alert(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${jsonData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!`);
      };
      reader.readAsArrayBuffer(file);
    }

    // ===== Google Sheets (‡∏ú‡πà‡∏≤‡∏ô Apps Script Web App) =====
    async function connectGoogleSheets() {
      if (isGoogleSheetsConnected) {alert('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß'); return;}
      try {
        document.querySelector('.google-sheets-info').innerHTML = `
      <h3>üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets...</h3><p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà</p>`;
        const resp = await fetch(WEB_APP_URL, {method: 'GET'});
        if (!resp.ok) throw new Error('Cannot reach Web App');

        isGoogleSheetsConnected = true;
        document.querySelector('.google-sheets-info').innerHTML = `
      <h3>‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</h3>
      <p>üîó <a href="https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/edit" target="_blank">‡πÄ‡∏õ‡∏¥‡∏î Google Sheets</a></p>
      <p>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
      <div style="margin-top: 15px;">
        <button class="btn btn-success" onclick="syncAllDataToGoogleSheets()" style="margin-right:10px;">üì§ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        <button class="btn btn-warning" onclick="createSheetsHeaders()" style="margin-right:10px;">üìã ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á</button>
        <button class="btn btn-danger" onclick="disconnectGoogleSheets()">‡∏ï‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</button>
      </div>`;
        alert('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
      } catch (err) {
        console.error(err);
        alert('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Web App URL ‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á');
      }
    }
    function disconnectGoogleSheets() {
      isGoogleSheetsConnected = false;
      document.querySelector('.google-sheets-info').innerHTML = `
    <h3>üîó ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets</h3>
    <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÉ‡∏ô Google Sheets ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
    <p>üìä Target Sheet: <a href="https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/edit" target="_blank">‡πÄ‡∏õ‡∏¥‡∏î Google Sheets</a></p>
    <button class="btn btn-primary" onclick="connectGoogleSheets()">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets</button>`;
      alert('‡∏ï‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
    }
    async function createSheetsHeaders() {
      if (!isGoogleSheetsConnected) {alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡∏Å‡πà‡∏≠‡∏ô'); return;}
      try {
        const body = 'payload=' + encodeURIComponent(JSON.stringify({action: 'createHeaders'}));
        const resp = await fetch(WEB_APP_URL, {
          method: 'POST',
          headers: {'Content-Type': 'application/x-www-form-urlencoded'},
          body
        });
        const data = await resp.json();
        if (!data.ok) throw new Error(data.message || 'create headers failed');
        alert('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏ô Google Sheets ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
      } catch (err) {
        console.error(err);
        alert('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      }
    }
    async function syncToGoogleSheets(record) {
      if (!isGoogleSheetsConnected) return;
      try {
        const payload = {
          action: 'append',
          record: {
            date: record.date,
            studentId: record.studentId,
            studentName: record.studentName,
            className: record.className,
            incidentType: record.incidentType,
            description: record.description,
            severity: record.severity,
            imagesCount: Array.isArray(record.images) ? record.images.length : 0,
            recorder: record.recorder,
            loggedAt: new Date().toISOString().split('T')[0]
          }
        };
        const body = 'payload=' + encodeURIComponent(JSON.stringify(payload));
        const resp = await fetch(WEB_APP_URL, {
          method: 'POST',
          headers: {'Content-Type': 'application/x-www-form-urlencoded'},
          body
        });
        const data = await resp.json();
        if (!data.ok) throw new Error(data.message || 'append failed');
        console.log('Synced 1 record to Google Sheets');
      } catch (err) {
        console.error('Sync 1 record error:', err);
        alert('‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheets ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      }
    }
    async function syncAllDataToGoogleSheets() {
      if (!isGoogleSheetsConnected) {alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡∏Å‡πà‡∏≠‡∏ô'); return;}
      if (records.length === 0) {alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á'); return;}
      try {
        const list = records.map(r => ({
          date: r.date, studentId: r.studentId, studentName: r.studentName, className: r.className,
          incidentType: r.incidentType, description: r.description, severity: r.severity,
          imagesCount: Array.isArray(r.images) ? r.images.length : 0, recorder: r.recorder,
          loggedAt: new Date().toISOString().split('T')[0]
        }));
        const body = 'payload=' + encodeURIComponent(JSON.stringify({action: 'appendBulk', records: list}));
        const resp = await fetch(WEB_APP_URL, {
          method: 'POST',
          headers: {'Content-Type': 'application/x-www-form-urlencoded'},
          body
        });
        const data = await resp.json();
        if (!data.ok) throw new Error(data.message || 'append bulk failed');
        alert(`‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${records.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!`);
      } catch (err) {
        console.error(err);
        alert('‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      }
    }

    // ===== Misc =====
    function showImageModal(imageSrc) {
      const modal = document.createElement('div');
      modal.style.cssText = `position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);display:flex;justify-content:center;align-items:center;z-index:2000;cursor:pointer;`;
      const img = document.createElement('img');
      img.src = imageSrc;
      img.style.cssText = `max-width:90%;max-height:90%;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.5);`;
      modal.appendChild(img);
      document.body.appendChild(modal);
      modal.onclick = () => document.body.removeChild(modal);
    }
    window.onclick = function (e) {
      const modal = document.getElementById('recordModal');
      if (e.target === modal) {closeModal();}
    };
    document.addEventListener('keydown', function (e) {
      if (e.ctrlKey && e.key === 'n') {e.preventDefault(); openModal();}
      if (e.key === 'Escape') {closeModal();}
    });
    setInterval(function () {
      if (isGoogleSheetsConnected && records.length > 0) {
        console.log('Auto-sync heartbeat...');
      }
    }, 30000);
    function printReport() {window.print();}
    function addTooltips() {
      const items = [
        {selector: '.btn-success', text: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà (Ctrl+N)'},
        {selector: '.btn-primary', text: '‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel'},
        {selector: '.btn-warning', text: '‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel'},
        {selector: '.search-box', text: '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á'}
      ];
      items.forEach(i => {const el = document.querySelector(i.selector); if (el) el.title = i.text;});
    }
    function addAdditionalControls() {
      const controls = document.querySelector('.controls');
      const btn = document.createElement('button');
      btn.className = 'btn btn-primary';
      btn.innerHTML = 'üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô';
      btn.onclick = printReport;
      controls.appendChild(btn);
    }
  </script>
</body>

</html>